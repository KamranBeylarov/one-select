(n=>{"function"==typeof define&&define.amd?define(["jquery"],n):"object"==typeof module&&module.exports?module.exports=function(e,t){return void 0===t&&(t="undefined"!=typeof window?require("jquery"):require("jquery")(e)),n(t),t}:n(window.jQuery||window.$)})(function(c){var t={},i="oneSelect";function a(e,t){this.element=e,this.$element=c(e),this.instanceId="ones-"+Math.random().toString(36).substr(2,9),e=this.readDataAttributes(),this.settings=c.extend({},a.defaults,t,e),this.init()}a.defaults={placeholder:"Select options...",selectAllText:"Select All",okText:"OK",cancelText:"Cancel",data:[],value:null,showCheckbox:!0,showBadges:!1,showBadgesExternal:null,showSearch:!1,searchPlaceholder:"Search...",searchUrl:null,searchDebounceDelay:300,closeOnScroll:!1,closeOnOutside:!0,submitForm:!1,submitOnOutside:!1,formId:null,name:null,multiple:!0,ajax:null,autoLoad:!0,beforeLoad:null,afterLoad:null,onLoadError:null,onChange:null,onSelect:null,onOk:null,onCancel:null},a.prototype={readDataAttributes:function(){var e=this,o={},t=(c.each({"ones-placeholder":"placeholder","ones-select-all-text":"selectAllText","ones-ok-text":"okText","ones-cancel-text":"cancelText","ones-data":"data","ones-value":"value","ones-name":"name","ones-multiple":"multiple","ones-show-checkbox":"showCheckbox","ones-show-badges":"showBadges","ones-show-badges-external":"showBadgesExternal","ones-show-search":"showSearch","ones-search-placeholder":"searchPlaceholder","ones-search-url":"searchUrl","ones-search-debounce-delay":"searchDebounceDelay","ones-close-on-scroll":"closeOnScroll","ones-close-on-outside":"closeOnOutside","ones-submit-form":"submitForm","ones-submit-on-outside":"submitOnOutside","ones-form-id":"formId","ones-auto-load":"autoLoad"},function(t,n){var s=e.$element.data(t);if(void 0!==s)if("data"===n||"value"===n)if("string"==typeof s)try{o[n]=JSON.parse(s)}catch(e){console.warn("OneSelect: Invalid JSON for "+t,s),o[n]=s}else o[n]=s;else o[n]="multiple"===n||"showCheckbox"===n||"showBadges"===n||"showSearch"===n||"closeOnScroll"===n||"closeOnOutside"===n||"submitForm"===n||"submitOnOutside"===n||"autoLoad"===n?"string"==typeof s?"true"===s||"1"===s:!!s:"searchDebounceDelay"===n?"string"==typeof s?parseInt(s,10)||300:s||300:s}),this.$element.data("ones-ajax"));if(t)if("string"==typeof t)try{o.ajax=JSON.parse(t)}catch(e){console.warn("OneSelect: Invalid JSON for ones-ajax",t)}else o.ajax=t;return o},init:function(){null!=(t[this.instanceId]=this).settings.value?Array.isArray(this.settings.value)||(this.settings.value=[this.settings.value]):this.settings.value=[],this.wrapper=this.createWrapper(),this.trigger=this.createTrigger(),this.dropdown=this.createDropdown(),this.searchInput=this.createSearchInput(),this.optionsContainer=this.createOptionsContainer(),this.buttons=this.createButtons(),this.build(),this.attachEvents(),this.settings.ajax&&this.settings.autoLoad&&this.loadData()},build:function(){this.settings.showSearch&&this.dropdown.append(this.searchInput),this.dropdown.append(this.optionsContainer),this.dropdown.append(this.buttons),this.wrapper.append(this.trigger),this.$element.append(this.wrapper),c("body").append(this.dropdown),this.renderOptions(),this.updateTriggerText(),this.updateHiddenInputs()},updateHiddenInputs:function(){var n,s,e;this.settings.name&&(e=null,(n=(e=this.settings.formId?c("#"+this.settings.formId):this.$element.closest("form")).length?e:this.wrapper).find('input.cms-hidden-input[data-cms-input="'+this.settings.name+'"]').remove(),s=this.settings.name,this.settings.multiple&&-1===s.indexOf("[")&&(s+="[]"),e=this.getSelectedValues(),this.settings.multiple?c.each(e,function(e,t){t=c('<input type="hidden" class="cms-hidden-input">').attr("name",s).attr("value",t).attr("data-cms-input",this.settings.name).attr("data-cms-value",t);n.append(t)}.bind(this)):(e=0<e.length?e.join(","):"",e=c('<input type="hidden" class="cms-hidden-input">').attr("name",s).attr("value",e).attr("data-cms-input",this.settings.name),n.append(e)))},createWrapper:function(){return c('<div class="cms-wrapper"></div>')},createTrigger:function(){return c('<div class="cms-trigger"><span class="cms-selected-text cms-placeholder">'+this.settings.placeholder+"</span></div>")},createDropdown:function(){return c('<div class="cms-dropdown"></div>')},createSearchInput:function(){return c('<div class="cms-search-wrapper"><input type="text" class="cms-search-input" placeholder="'+this.settings.searchPlaceholder+'" /></div>')},createOptionsContainer:function(){return c('<div class="cms-options-container"></div>')},createButtons:function(){var e=c('<div class="cms-buttons"></div>');return this.okBtn=c('<button class="cms-btn cms-btn-ok">'+this.settings.okText+"</button>"),this.cancelBtn=c('<button class="cms-btn cms-btn-cancel">'+this.settings.cancelText+"</button>"),e.append(this.okBtn),e.append(this.cancelBtn),e},renderOptions:function(){this.optionsContainer.empty();var e=this.createOption("select-all",this.settings.selectAllText,!1),s=(this.optionsContainer.append(e),this);c.each(this.settings.data,function(e,t){var n=-1!==c.inArray(e,s.settings.value),e=s.createOption(e,t,n);s.optionsContainer.append(e)}),this.updateSelectAllState()},createOption:function(e,t,n){var s="cms-option",s=(this.settings.showCheckbox||(s+=" cms-hide-checkbox"),n&&"select-all"!==e&&(s+=" selected"),c('<div class="'+s+'" data-value="'+e+'"></div>')),e=c('<input type="checkbox" value="'+e+'"'+(n?" checked":"")+">"),n=c("<label>"+t+"</label>");return s.append(e),s.append(n),s},filterOptions:function(t){var e=this.optionsContainer.find('.cms-option:not([data-value="select-all"])');""===t?e.show():e.each(function(){var e=c(this);-1!==e.find("label").text().toLowerCase().indexOf(t)?e.show():e.hide()})},performAjaxSearch:function(e){var s=this;this.optionsContainer.addClass("cms-loading"),c.ajax({url:this.settings.searchUrl,method:"GET",data:{q:e},dataType:"json",success:function(e){var t=e;"object"==typeof e&&e.data?t=e.data:"object"==typeof e&&e.results&&(t=e.results),s.updateSearchResults(t||[]),s.optionsContainer.removeClass("cms-loading")},error:function(e,t,n){console.error("OneSelect: Search error",n),s.optionsContainer.removeClass("cms-loading"),s.settings.onLoadError&&s.settings.onLoadError.call(s,e,t,n)}})},updateSearchResults:function(e){this.optionsContainer.find('.cms-option:not([data-value="select-all"])').remove();var s=this;c.each(e,function(e,t){var n=-1!==c.inArray(e,s.settings.value),e=s.createOption(e,t,n);s.optionsContainer.append(e)}),this.updateSelectAllState()},attachEvents:function(){var t,n,s,o,i=this,a=0<=navigator.platform.toUpperCase().indexOf("MAC")||0<=navigator.platform.toUpperCase().indexOf("IPHONE")||0<=navigator.platform.toUpperCase().indexOf("IPAD")||-1!==navigator.userAgent.indexOf("Macintosh")?100:0;function l(e){return e===document?"document":e===document.documentElement?"html":e===document.body?"body":e.tagName+"-"+(e.id||e.className||Math.random().toString(36).substr(2,9))}this.trigger.on("click",function(e){e.stopPropagation(),i.toggle()}),this.settings.showSearch&&(this.settings.searchUrl?(n=function(e){i.performAjaxSearch(e)},s=this.settings.searchDebounceDelay,t=function(){var e=this,t=arguments;clearTimeout(o),o=setTimeout(function(){n.apply(e,t)},s)},this.searchInput.find(".cms-search-input").on("keyup",function(){var e=c(this).val();0<e.length?t(e):i.filterOptions("")})):this.searchInput.find(".cms-search-input").on("keyup",function(){var e=c(this).val().toLowerCase();i.filterOptions(e)})),c(window).on("resize.cms",function(){i.wrapper.hasClass("open")&&i.updateDropdownPosition()}),this.settings.closeOnScroll?c(window).on("scroll.cms",function(){i.wrapper.hasClass("open")&&i.close()}):c(window).on("scroll.cms",function(){i.wrapper.hasClass("open")&&i.updateDropdownPosition()}),c(document).on("wheel.onescroll",function(e){i.wrapper.hasClass("open")&&e.originalEvent&&Math.abs(e.originalEvent.deltaX)>a&&i.close()}),i._detectHorizontalScroll=function(){if(i.wrapper.hasClass("open"))if(window.scrollX!==i._lastWindowScrollX&&(i._lastWindowScrollX=window.scrollX,0<i._lastWindowScrollX))i.close();else for(var e=document.querySelectorAll("*"),t=0;t<e.length;t++){var n=e[t],s=l(n);if(void 0!==i._elementScrollPositions[s])if(n.scrollLeft!==i._elementScrollPositions[s])return void i.close()}},i._elementScrollPositions={},i._lastWindowScrollX=window.scrollX;var r=i.open.bind(i),e=(i.open=function(){i._elementScrollPositions={},i._lastWindowScrollX=window.scrollX;for(var e=document.querySelectorAll("*"),t=0;t<e.length;t++){var n=e[t];(n.scrollWidth>n.clientWidth||n.scrollHeight>n.clientHeight)&&(i._elementScrollPositions[l(n)]=n.scrollLeft)}i._horizontalScrollInterval&&clearInterval(i._horizontalScrollInterval),i._horizontalScrollInterval=setInterval(function(){i._detectHorizontalScroll()},50),r()},i.close.bind(i));i.close=function(){i._horizontalScrollInterval&&(clearInterval(i._horizontalScrollInterval),i._horizontalScrollInterval=null),i._elementScrollPositions={},e()},c(window).on("click.ones",function(e){!i.settings.closeOnOutside||!i.wrapper.hasClass("open")||0<(e=c(e.target)).closest(".cms-wrapper").length||0<e.closest(".cms-dropdown").length||(i.settings.submitOnOutside&&(i.updateTriggerText(),i.settings.onOk&&i.settings.onOk.call(i,i.getSelectedValues(),i.getSelectedLabels()),i.submitForm()),i.close())}),this.optionsContainer.on("click",".cms-option",function(e){e.stopPropagation();var t=c(this),n=t.find('input[type="checkbox"]');c(e.target).is('input[type="checkbox"]')||(n.prop("checked",!n.prop("checked")),i.handleOptionChange(t))}),this.optionsContainer.on("change",'input[type="checkbox"]',function(e){e.stopPropagation();e=c(e.target).closest(".cms-option");i.handleOptionChange(e)}),this.okBtn.on("click",function(e){e.stopPropagation(),i.handleOk()}),this.cancelBtn.on("click",function(e){e.stopPropagation(),i.handleCancel()})},handleOptionChange:function(e){var t,n;"select-all"===e.data("value")?(t=e.find('input[type="checkbox"]'),this.handleSelectAll(t.prop("checked"))):((t=e.find('input[type="checkbox"]')).prop("checked")?e.addClass("selected"):e.removeClass("selected"),n=this,setTimeout(function(){n.updateSelectAllState(),n.updateTriggerText()},0)),this.updateHiddenInputs(),this.settings.onChange&&this.settings.onChange.call(this,this.getSelectedValues(),this.getSelectedLabels()),this.settings.onSelect&&this.settings.onSelect.call(this,this.getSelectedValues())},handleSelectAll:function(t){this.optionsContainer.find('.cms-option:not([data-value="select-all"])').each(function(){var e=c(this);e.find('input[type="checkbox"]').prop("checked",t),t?e.addClass("selected"):e.removeClass("selected")}),this.updateSelectAllState(),this.updateTriggerText(),this.updateHiddenInputs()},updateSelectAllState:function(){var e=this.optionsContainer.find('.cms-option:not([data-value="select-all"]) input[type="checkbox"]'),t=e.filter(":checked"),e=e.length,t=t.length,n=this.optionsContainer.find('.cms-option[data-value="select-all"] input[type="checkbox"]');n.prop("indeterminate",!1),n.prop("checked",!1),0!==t&&(t===e&&0<e?n.prop("checked",!0):n.prop("indeterminate",!0))},getSelectedValues:function(){var t=[];return this.optionsContainer.find('.cms-option:not([data-value="select-all"]) input[type="checkbox"]:checked').each(function(){var e=c(this).val();isNaN(e)||""===e||(e=Number(e)),t.push(e)}),t},getSelectedLabels:function(){var e=[];return this.optionsContainer.find('.cms-option:not([data-value="select-all"]) input[type="checkbox"]:checked').siblings("label").each(function(){e.push(c(this).text())}),e},updateTriggerText:function(){var o,i=this.getSelectedLabels(),e=this.getSelectedValues(),a=this.trigger.find(".cms-selected-text");0===i.length?a.empty().text(this.settings.placeholder).addClass("cms-placeholder"):this.settings.showBadges?(a.empty().removeClass("cms-placeholder"),o=this,c.each(e,function(e,t){var n=c('<span class="cms-badge"></span>'),e=c("<span></span>").text(i[e]),s=c('<button type="button" class="cms-badge-remove">&times;</button>');s.on("click",function(e){e.stopPropagation(),o.unselect(t)}),n.append(e),n.append(s),a.append(n)})):(a.empty().removeClass("cms-placeholder"),a.text(i.length+" items selected")),this.updateExternalBadges(e,i)},updateExternalBadges:function(e,o){var i,a;this.settings.showBadgesExternal&&(0===(i=c("#"+this.settings.showBadgesExternal)).length?console.warn("OneSelect: External container not found - #"+this.settings.showBadgesExternal):(i.empty(),0!==e.length&&(a=this,c.each(e,function(e,t){var n=c('<span class="cms-badge"></span>'),e=c("<span></span>").text(o[e]),s=c('<button type="button" class="cms-badge-remove">&times;</button>');s.on("click",function(e){e.preventDefault(),e.stopPropagation(),a.unselect(t)}),n.append(e),n.append(s),i.append(n)}))))},toggle:function(){this.wrapper.hasClass("open")?this.close():this.open()},open:function(){c(".cms-wrapper.open").not(this.wrapper).removeClass("open"),c(".cms-dropdown.open").not(this.dropdown).removeClass("open"),this.updateDropdownPosition(),this.wrapper.addClass("open"),this.dropdown.addClass("open")},updateDropdownPosition:function(){var e=this.wrapper[0].getBoundingClientRect(),t=(this.wrapper.outerHeight(),this.wrapper.outerWidth());this.dropdown.css({position:"fixed",top:e.bottom+"px",left:e.left+"px",width:t+"px"})},close:function(){this.wrapper.removeClass("open"),this.dropdown.removeClass("open")},handleOk:function(){this.updateTriggerText();var e=this.getSelectedValues(),t=this.getSelectedLabels();this.settings.onOk&&this.settings.onOk.call(this,e,t),this.settings.submitForm&&this.submitForm(),this.close()},submitForm:function(){var e=null;if(this.settings.formId){if(0===(e=c("#"+this.settings.formId)).length)return void console.warn('OneSelect: Form with ID "'+this.settings.formId+'" not found')}else if(0===(e=this.$element.closest("form")).length)return void console.warn("OneSelect: No parent form found");e[0].submit()},handleCancel:function(){this.settings.value=[],this.optionsContainer.find('input[type="checkbox"]').prop("checked",!1),this.optionsContainer.find(".cms-option").removeClass("selected"),this.updateSelectAllState(),this.updateTriggerText(),this.updateHiddenInputs(),this.settings.onCancel&&this.settings.onCancel.call(this),this.settings.submitForm&&this.submitForm(),this.close()},setValue:function(e){this.settings.value=e||[],this.renderOptions(),this.updateTriggerText(),this.updateHiddenInputs()},getValue:function(){return this.getSelectedValues()},updateData:function(e){this.settings.data=e||[],this.settings.value=[],this.renderOptions(),this.updateTriggerText(),this.updateHiddenInputs()},loadData:function(e,n,s){var t,o,i=this,a=e||this.settings.ajax;a&&a.url?(this.settings.beforeLoad&&this.settings.beforeLoad.call(this),this.trigger.find(".cms-selected-text").text("Loading..."),e=c.extend(!0,{url:a.url,method:a.method||"GET",data:a.data||{},dataType:a.dataType||"json",success:function(e){var t=e;"object"==typeof e&&e.data?t=e.data:"object"==typeof e&&e.results&&(t=e.results),i.settings.data=t||[],i.renderOptions(),i.updateTriggerText(),i.settings.afterLoad&&i.settings.afterLoad.call(i,t,e),n&&n.call(i,t,e)},error:function(e,t,n){i.trigger.find(".cms-selected-text").text("Error loading data"),i.settings.onLoadError&&i.settings.onLoadError.call(i,e,t,n),s&&s.call(i,e,t,n)}},a),a.success&&(t=e.success,e.success=function(e){a.success(e),t(e)}),a.error&&(o=e.error,e.error=function(e,t,n){a.error(e,t,n),o(e,t,n)}),c.ajax(e)):console.error("OneSelect: Ajax configuration or url is missing")},reload:function(){this.settings.ajax?this.loadData():console.warn("OneSelect: No ajax configuration found")},select:function(e){e=this.optionsContainer.find('.cms-option:not([data-value="select-all"]) input[type="checkbox"][value="'+e+'"]');e.length&&(e.prop("checked",!0),e.closest(".cms-option").addClass("selected"),this.updateSelectAllState(),this.updateTriggerText(),this.updateHiddenInputs())},unselect:function(e){e=this.optionsContainer.find('.cms-option:not([data-value="select-all"]) input[type="checkbox"][value="'+e+'"]');e.length&&(e.prop("checked",!1),e.closest(".cms-option").removeClass("selected"),this.updateSelectAllState(),this.updateTriggerText(),this.updateHiddenInputs())},selectAll:function(){this.handleSelectAll(!0)},unselectAll:function(){this.handleSelectAll(!1)},toggleSelection:function(e){var t,e=this.optionsContainer.find('.cms-option:not([data-value="select-all"]) input[type="checkbox"][value="'+e+'"]');e.length&&(t=e.prop("checked"),e.prop("checked",!t),e=e.closest(".cms-option"),t?e.removeClass("selected"):e.addClass("selected"),this.updateSelectAllState(),this.updateTriggerText(),this.updateHiddenInputs())},getInstanceId:function(){return this.instanceId},destroy:function(){delete t[this.instanceId],c(window).off(".cms"),c(window).off(".ones"),c(document).off(".onescroll"),this.trigger.off(),this.okBtn.off(),this.cancelBtn.off(),this.optionsContainer.off(),this._horizontalScrollInterval&&(clearInterval(this._horizontalScrollInterval),this._horizontalScrollInterval=null),c('input.cms-hidden-input[data-cms-input="'+this.settings.name+'"]').remove(),this.wrapper.remove(),this.dropdown.remove(),this.$element.removeData(i)}},a.getInstance=function(e){return t[e]||null},a.getAllInstances=function(){return t},c.fn[i]=function(n){var s=arguments,o=this;return this.each(function(){var e=c(this),t=e.data(i);if(!t){if("object"!=typeof n&&n)return;t=new a(this,n),e.data(i,t)}"string"==typeof n&&("value"===n?o=void 0!==s[1]?(t.setValue(s[1]),e):t.getValue():"getValues"===n?o=t.getSelectedValues():"getLabels"===n?o=t.getSelectedLabels():"getInstanceId"===n?o=t.getInstanceId():"updateData"===n?t.updateData(s[1]):"loadData"===n?t.loadData(s[1],s[2],s[3]):"reload"===n?t.reload():"select"===n?t.select(s[1]):"unselect"===n?t.unselect(s[1]):"selectAll"===n?t.selectAll():"unselectAll"===n?t.unselectAll():"toggleSelection"===n?t.toggleSelection(s[1]):"open"===n?t.open():"close"===n?t.close():"destroy"===n&&t.destroy())}),o},c.fn[i].Constructor=a,c.fn[i].getInstance=a.getInstance,c.fn[i].getAllInstances=a.getAllInstances});